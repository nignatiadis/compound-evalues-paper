# Compound E-values: Reproduction Code

This repository contains the reproduction code for the paper:

**"Asymptotic and compound e-values: multiple testing and empirical Bayes"**  
*Nikolaos Ignatiadis, Ruodu Wang, Aaditya Ramdas*  
arXiv:2409.19812  
[https://arxiv.org/abs/2409.19812](https://arxiv.org/abs/2409.19812)

Repository URL: [https://github.com/nignatiadis/compound-evalues-paper](https://github.com/nignatiadis/compound-evalues-paper)

## Overview

This paper introduces compound e-values in multiple testing and statistical inference, showing how every FDR controlling procedure can be recovered through the e-BH procedure with appropriate compound e-values. The research connects compound e-values to empirical Bayes methods and derives log-optimal compound e-values for testing point nulls against point alternatives.

## Repository Contents

The main files in this repository include:

### Core Julia Files
- `Project.toml` - Julia project file specifying package dependencies and environment configuration
- `Manifest.toml` - Exact versions of all dependencies for reproducibility (automatically generated by Julia's package manager)
- `methods.jl` - Implementation of the statistical methods from the paper
- `utils.jl` - Utility functions for simulations and analysis
- `run_simulation.jl` - Main simulation script (requires task ID as command line argument)
- `analyze_simulations.jl` - Analysis of simulation results
- `figures.qmd` - Quarto document for generating figures

### High-Performance Computing
- `simulations.sbatch` - SLURM batch script for running simulations on HPC clusters

### Results
- `simulation_results/` - Directory for storing simulation results (currently empty, populated by running `run_simulation.jl` which saves `.jld2` files)

## Getting Started

### Prerequisites
- Julia (version specified in `Project.toml`)
- For HPC simulations: SLURM job scheduler

### Installation

1. Clone this repository:
```bash
git clone https://github.com/nignatiadis/compound-evalues-paper.git
cd compound-evalues-paper
```

2. Start Julia and activate the project environment:
```julia
julia --project=.
```

3. Install dependencies:
```julia
using Pkg
Pkg.instantiate()
```

### Running Simulations

The simulation script `run_simulation.jl` is designed for parallel execution across different parameter combinations.

#### Local Execution
To run a single simulation task locally, you need to specify a task ID (1-96, corresponding to different combinations of variance settings, effect sizes, and K values):

```julia
julia --project=. run_simulation.jl 1
```

The task ID determines which parameter combination to run:
- Variance settings: Dirac(1.0) and Uniform(0.5, 2.0)  
- Effect sizes: 2.0 to 6.0 in steps of 0.25
- K values: 5 and 10

#### HPC Cluster
For large-scale simulations on an HPC cluster with SLURM (runs all 96 parameter combinations in parallel):
```bash
sbatch simulations.sbatch
```

### Analyzing Results
After simulations complete, analyze the results:
```julia
julia --project=. analyze_simulations.jl
```

### Generating Figures
To reproduce the figures from the paper:
```bash
quarto render figures.qmd
```

## Citation

If you use this code, please cite:

```bibtex
@article{ignatiadis2024compound,
  title={Asymptotic and compound e-values: multiple testing and empirical Bayes},
  author={Ignatiadis, Nikolaos and Wang, Ruodu and Ramdas, Aaditya},
  journal={arXiv preprint arXiv:2409.19812},
  year={2024}
}
```
